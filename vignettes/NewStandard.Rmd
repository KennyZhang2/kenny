---
title: "From raw to tidy data (ATT&CK and CAPEC)"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{From raw to tidy data (ATT&CK and CAPEC)}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
library("kableExtra")
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

randomSample <- function(df, n) { 
   return(df[sample(nrow(df), n),])
}
```

## MITRE ATT&CK Design and Philosophy

[Paper](https://www.mitre.org/publications/technical-papers/mitre-attack-design-and-philosophy)

## MITRE CTI repository analysis

[MITRE CTI](https://github.com/mitre/cti): The Cyber Threat Intelligence Repository of ATT&CK and CAPEC catalogs expressed in STIX 2.0 JSON.

> **[TODO]**   
> - Add description about standards and CTI repository.  
> - Why this repository? There are others?  
> - Analyze schemas: ATT&CL Property, ATT&CK MediaWiki, STIX Properties  
> - Relationship with other standards? CWE? CAPEC? Others?
> - Example of use cases?
>

### ATT&CK source data sets

```{r map_attck_stix, cache=TRUE}
a2s <- net.security::attck2stix()
```

#### Objects

```{r map_attck_objects}
a2s.objects <- a2s$Objects
kable(a2s.objects)
```

#### Common properties

```{r map_attck_common}
a2s.common <- a2s$`Common properties (on all objects)`
kable(a2s.common)
```

#### Techniques

```{r map_attck_techniques}
a2s.tech <- a2s$Techniques
kable(a2s.tech)
```

#### Software

```{r map_attck_software}
a2s.soft <- a2s$Software
kable(a2s.soft)
```

#### Groups

```{r map_attck_groups}
a2s.groups <- a2s$Groups
kable(a2s.groups)
```

### CAPEC source data sets

```{r map_capec_stix, cache=TRUE}
doc <- xml2::read_html("https://github.com/mitre/cti/blob/master/USAGE-CAPEC.md")
capec2stix <- rvest::html_table(doc)[[1]]
kable(capec2stix)
```

## Building ATT&CK concepts

### Parsing CTI Repository files and Objects mapping.

#### From x-mitre-tactic (STIX) to Tactics (ATT&CK)

```{r attack_tact, cache=TRUE}
attck.tact <- net.security::parseAttck.Tactics()
summary(attck.tact)
```

```{r attack_tact_table}
kable(attck.tact) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")
```

#### From attack-pattern (STIX) to Techniques (ATT&CK)

```{r attack_tech, cache=TRUE}
attck.tech <- net.security::parseAttck.Techniques()
summary(attck.tech)
```

```{r attack_tech_table}
kable(randomSample(attck.tech, 50)) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")
```

#### From intrusion-set (STIX) to Groups (ATT&CK)

```{r attack_group, cache=TRUE}
attck.groups <- net.security::parseAttck.Groups()
summary(attck.groups)
```

```{r attack_group_table}
kable(randomSample(attck.groups, 40)) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")
```

#### From malware and tool (STIX) to Software (ATT&CK)

```{r attack_software, cache=TRUE}
attck.soft <- net.security::parseAttck.Software()
summary(attck.soft)
```

```{r attack_software_table}
kable(randomSample(attck.soft, 40)) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")
```

#### ATT&CK Relationships
```{r attack_relations, cache=TRUE}
attck.relations <- net.security::parseAttck.Relationships()
summary(attck.relations)
```

```{r attack_relations_table}
kable(randomSample(attck.relations, 100)) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")
```

### Building Standard Data Sets

#### ATT&CK Tactics tidy data frame

```{r attack_tidy_tactics}
#attck.tact <- buildAttckTactics()
```


## Package net.security

MITRE CAPEC Community publish a [release archive](https://capec.mitre.org/data/archive.html) that includes previous versions of the core content downloads, schemas, schema documentation, and difference reports. The net.security Rpackage provides functions to download, parse and build data.frame based on CAPEC XML version 2.10.

```{r setup}
library(net.security)
capec <- net.security::GetDataFrame(ds = "capec")
summary(capec)
```
